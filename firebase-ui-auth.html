<link rel="import" href="../polymer/polymer.html">
<script src="https://www.gstatic.com/firebasejs/ui/live/1.0/firebase-ui-auth.js"></script>
<link type="text/css" rel="stylesheet" href="https://www.gstatic.com/firebasejs/ui/live/1.0/firebase-ui-auth.css" />
<!--
  `<firebase-ui-auth></firebase-ui-auth>` HTML wrapper for firebase-ui-auth.js
  @demo demo.html
-->
<dom-module id="firebase-ui-auth">
  <template>
    <template is="dom-if" if="{{!user}}">
      <div id="firebaseui-auth-container"></div>
    </template>
  </template>
</dom-module>
<script>
  Polymer({
    is: "firebase-ui-auth",
    properties:{
      user:{
        notify:true,
      },
      signInSuccessUrl:{
        value: "/"
      },
      signInOptions :{
        value:[
          firebase.auth.GoogleAuthProvider.PROVIDER_ID,
          firebase.auth.FacebookAuthProvider.PROVIDER_ID,
          firebase.auth.TwitterAuthProvider.PROVIDER_ID,
          firebase.auth.GithubAuthProvider.PROVIDER_ID,
          firebase.auth.EmailAuthProvider.PROVIDER_ID
        ],
        type: Array
      },
      tosUrl:{
        value: "/"
      },
      ui: {
        notify:true,
        computed: "getUi(signInSuccessUrl,signInOptions,tosUrl,user)"
      }
    },
    ready: function(){
      console.log("ready")
      var that = this
      var trys = 0 
      function auth() {
        if (firebase) {
          firebase.auth().onAuthStateChanged(function(user) {
            that.user = user
          }, function(error) {
            console.log(error)
          })
        } else {
          console.log(trys++)
          setTimeout(auth, 500)
        }
      }
      auth()
    },
    getUi: function(signInSuccessUrl,signInOptions,tosUrl,user){
      var uiConfig = {
        signInSuccessUrl: signInSuccessUrl,
        signInOptions: signInOptions,
        tosUrl: tosUrl,
      }
      var ui = new firebaseui.auth.AuthUI(firebase.auth())
      // The start method will wait until the DOM is loaded.
      ui.start('#firebaseui-auth-container', uiConfig)
      return ui
    },
  })
</script>
